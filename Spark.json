{"paragraphs":[{"title":"Download spending dataset into HDFS","text":"%md\n## Spark operation\n#### Sparkでのデータ加工と分析\n<br>\nScript for Workshop to Big Data by DELLEMC","dateUpdated":"2019-06-19T07:55:57+0000","config":{"colWidth":12,"editorHide":true,"tableHide":false,"title":false,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/markdown"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1560921127664_1146883920","id":"20150522-145401_1470736167","result":{"code":"SUCCESS","type":"HTML","msg":"<h2>Spark operation</h2>\n<h4>Sparkでのデータ加工と分析</h4>\n<p><br>\n<br  />Script for Workshop to Big Data by DELLEMC</p>\n"},"dateCreated":"2019-06-19T05:12:07+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:41918","dateFinished":"2019-06-19T07:55:57+0000","dateStarted":"2019-06-19T07:55:57+0000","focus":true},{"title":"データのダウンロード","text":"%sh\n\n# データセットのダウンロード\n# オーストラリアの社会福祉支出データ\nwget https://data.gov.au/dataset/f84b9baf-c1c1-437c-8c1e-654b2829848c/resource/88399d53-d55c-466c-8f4a-6cb965d24d6d/download/healthexpenditurebyareaandsource.csv -O /tmp/expenses.csv","dateUpdated":"2019-06-19T07:55:34+0000","config":{"colWidth":12,"editorMode":"ace/mode/sh","title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1560921127664_1146883920","id":"20150524-025502_1843984349","dateCreated":"2019-06-19T05:12:07+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:41919","dateFinished":"2019-06-19T07:55:36+0000","dateStarted":"2019-06-19T07:55:34+0000","focus":true},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/sh","title":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1560922353963_1930559422","id":"20190619-053233_1786296196","dateCreated":"2019-06-19T05:32:33+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:42554","text":"%sh\n\n# ヘッダーの削除\nsed -i '1d' /tmp/expenses.csv\n# 空白行の削除\nsed -i \"s/,,,,,//g\" /tmp/expenses.csv\nsed -i '/^\\s*$/d' /tmp/expenses.csv","dateUpdated":"2019-06-19T07:55:34+0000","dateFinished":"2019-06-19T07:55:34+0000","dateStarted":"2019-06-19T07:55:34+0000","errorMessage":"","title":"不要箇所の削除"},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/sh","title":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1560922690100_-954580635","id":"20190619-053810_125863005","dateCreated":"2019-06-19T05:38:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:42633","text":"%sh\n\n# HDFSへ投入\nhadoop fs -put /tmp/expenses.csv /tmp\n# ファイルの確認\nhadoop fs -ls -h /tmp/expenses.csv\n# 不要なファイルの削除\nrm /tmp/expenses.csv","dateUpdated":"2019-06-19T07:55:34+0000","dateFinished":"2019-06-19T07:55:39+0000","dateStarted":"2019-06-19T07:55:34+0000","errorMessage":"","title":"HDFSへデータセットを投入"},{"title":"データセットをSparkへ設定","text":"val dataset=sc.textFile(\"/tmp/expenses.csv\")","dateUpdated":"2019-06-19T07:55:34+0000","config":{"colWidth":12,"title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1560921127664_1146883920","id":"20150522-145506_1520223608","dateCreated":"2019-06-19T05:12:07+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:41920","dateFinished":"2019-06-19T07:55:34+0000","dateStarted":"2019-06-19T07:55:34+0000","focus":true},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"title":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1560923123029_1397773020","id":"20190619-054523_548960895","dateCreated":"2019-06-19T05:45:23+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:42709","text":"// ファイルのデータセットの総数を確認\ndataset.count()\n// １行目を確認\ndataset.first()","dateUpdated":"2019-06-19T07:55:34+0000","dateFinished":"2019-06-19T07:55:34+0000","dateStarted":"2019-06-19T07:55:34+0000","errorMessage":"","title":"データセットの確認"},{"title":"データセットのテーブル化","text":"\n// データ項目を設定\ncase class Health (year:  String, state: String, category:String, funding_src1: String, funding_scr2: String, spending: Integer)\n// 列ごとにデータを振り分ける\nval health = dataset.map(k=>k.split(\",\")).map(\n    k => Health(k(0),k(1),k(2),k(3), k(4), k(5).toInt)\n    )\n// 振り分けたデータをデータフレーム化\nhealth.toDF().registerTempTable(\"health_table\")","dateUpdated":"2019-06-19T07:55:34+0000","config":{"colWidth":12,"title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1560921127664_1146883920","id":"20150522-145554_1659286336","dateCreated":"2019-06-19T05:12:07+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:41921","dateFinished":"2019-06-19T07:55:35+0000","dateStarted":"2019-06-19T07:55:34+0000","focus":true},{"title":"州ごとの支出","text":"%sql\nselect state, sum(spending)/1000 SpendinginBillions \nfrom health_table \ngroup by state \norder by SpendinginBillions desc","dateUpdated":"2019-06-19T07:55:34+0000","config":{"tableHide":false,"colWidth":4,"editorMode":"ace/mode/sql","editorHide":false,"title":true,"graph":{"mode":"pieChart","height":300,"optionOpen":false,"keys":[{"name":"state","index":0,"aggr":"sum"}],"values":[{"name":"SpendinginBillions","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"state","index":0,"aggr":"sum"},"yAxis":{"name":"SpendinginBillions","index":1,"aggr":"sum"}}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1560921127664_1146883920","id":"20150522-145707_2030296925","dateCreated":"2019-06-19T05:12:07+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:41922","dateFinished":"2019-06-19T07:55:36+0000","dateStarted":"2019-06-19T07:55:35+0000","focus":true},{"title":"年間ごとの支出","text":"%sql\nselect year,sum(spending)/1000 SpendinginBillions \nfrom health_table \ngroup by year \norder by SpendinginBillions\n","dateUpdated":"2019-06-19T07:55:34+0000","config":{"tableHide":false,"colWidth":4,"editorMode":"ace/mode/sql","editorHide":false,"title":true,"graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"keys":[{"name":"year","index":0,"aggr":"sum"}],"values":[{"name":"SpendinginBillions","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"year","index":0,"aggr":"sum"},"yAxis":{"name":"SpendinginBillions","index":1,"aggr":"sum"}}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1560921127664_1146883920","id":"20150522-150006_2004946034","dateCreated":"2019-06-19T05:12:07+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:41923","dateFinished":"2019-06-19T07:55:37+0000","dateStarted":"2019-06-19T07:55:35+0000","focus":true},{"title":"エリアごとの支出","text":"%sql\nselect category, sum(spending)/1000 SpendinginBillions \nfrom health_table \ngroup by category \norder by SpendinginBillions desc","dateUpdated":"2019-06-19T07:59:59+0000","config":{"tableHide":false,"colWidth":4,"editorMode":"ace/mode/sql","editorHide":false,"title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[{"name":"category","index":0,"aggr":"sum"}],"values":[{"name":"SpendinginBillions","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"category","index":0,"aggr":"sum"},"yAxis":{"name":"SpendinginBillions","index":1,"aggr":"sum"}}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1560921127665_1146499172","id":"20150522-150103_460493658","dateCreated":"2019-06-19T05:12:07+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:41924","dateFinished":"2019-06-19T07:55:38+0000","dateStarted":"2019-06-19T07:55:36+0000","focus":true},{"dateUpdated":"2019-06-19T07:55:34+0000","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1560921127665_1146499172","id":"20150522-151420_2114334426","dateCreated":"2019-06-19T05:12:07+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:41925","dateFinished":"2019-06-19T07:55:38+0000","dateStarted":"2019-06-19T07:55:38+0000"}],"name":"Spark","id":"2EG5HPACM","angularObjects":{"2BYG9GAN3:shared_process":[],"2C139U1BG:shared_process":[],"2BYWWZJPK:shared_process":[],"2C2VAKPN2:shared_process":[],"2BZC2RPUW:shared_process":[],"2BZQEH9EH:shared_process":[]},"config":{"looknfeel":"default"},"info":{}}